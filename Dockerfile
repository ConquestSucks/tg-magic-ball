# ----------- Стадия сборки ------------
FROM node:20-alpine AS builder

# Рабочая директория внутри контейнера
WORKDIR /app

# Копируем только package.json и lock-файл для установки зависимостей
COPY package*.json ./

# Устанавливаем зависимости (dev-зависимости нужны для сборки)
RUN npm ci --include=dev

# Копируем остальные файлы проекта
COPY . .

# Собираем приложение (включая проверку типов)
RUN npm run build

# ----------- Стадия продакшена ------------
FROM node:20-alpine AS production

# Рабочая директория
WORKDIR /app

# Устанавливаем минимальный статический сервер
RUN npm install -g serve@14.2.0

# Копируем собранные файлы приложения
COPY --from=builder /app/dist ./dist

# Приложение будет доступно на порту 5173
EXPOSE 5173

# Запуск статического сервера
CMD ["serve", "-s", "dist", "-l", "5173"] 